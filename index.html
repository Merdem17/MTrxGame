<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Taş Oyunu</title>
  <style>
    body { 
      margin:0; 
      overflow:hidden; 
      background:black; 
      display:flex; 
      justify-content:center; 
      align-items:center; 
      height:100vh;
      flex-direction:column;
    }
    canvas { 
      background:black; 
      display:none; 
      border:4px solid #555; 
      box-shadow:0 0 20px rgba(255,255,255,0.2); 
    }
    #ui {
      position:absolute; 
      top:20px; 
      left:50%; 
      transform:translateX(-50%);
      color:white;
      font-family:sans-serif; 
      font-size:20px;
      display:none;
    }
    #levelUp {
      position:absolute; 
      top:50%; 
      left:50%; 
      transform:translate(-50%, -50%);
      color:lime; 
      font-size:48px; 
      font-weight:bold;
      text-shadow:0 0 15px #0f0;
      display:none;
      font-family:sans-serif;
    }
    #restart {
      position:absolute; 
      top:50%; 
      left:50%; 
      transform:translate(-50%, -50%);
      padding:15px 30px; 
      font-size:24px; 
      display:none;
      background:#444; 
      color:white; 
      border:none; 
      border-radius:10px; 
      cursor:pointer;
    }
    #restart:hover { background:#666; }
    #menu {
      display:flex;
      flex-direction:column;
      gap:20px;
      align-items:center;
      color:white;
      font-family:sans-serif;
    }
    .menu-btn {
      padding:15px 30px;
      font-size:22px;
      background:#222;
      color:white;
      border:none;
      border-radius:10px;
      cursor:pointer;
      box-shadow:0 0 10px rgba(255,255,255,0.3);
    }
    .menu-btn:hover {
      background:#444;
    }
    #playerName {
      padding:10px;
      font-size:18px;
      border-radius:8px;
      border:1px solid #555;
      text-align:center;
    }

    /* Modal arka plan */
    #nameSuggestions {
      display:none;
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.7);
      justify-content:center;
      align-items:center;
      z-index:1000;
    }
    /* Modal kutusu */
    #nameSuggestions .modal-content {
      background:#111;
      padding:20px;
      border-radius:12px;
      border:2px solid #555;
      text-align:center;
      color:white;
      max-width:320px;
      box-shadow:0 0 20px rgba(255,255,255,0.2);
    }
    #nameSuggestions p {
      margin-bottom:10px;
      font-size:16px;
      color:#ccc;
    }
    .suggestion-btn {
      display:block;
      width:100%;
      margin:5px 0;
      padding:8px;
      font-size:16px;
      background:#333;
      color:white;
      border:none;
      border-radius:6px;
      cursor:pointer;
    }
    .suggestion-btn:hover {
      background:#555;
    }
    .try-again-btn {
      margin-top:10px;
      background:#660000;
    }
    .try-again-btn:hover {
      background:#990000;
    }

    /* Sağdaki skor tablosu */
    #leaderboard {
      position:absolute;
      top:20px;
      right:20px;
      width:220px;
      background:#111;
      color:white;
      padding:10px;
      border:2px solid #555;
      border-radius:10px;
      font-family:sans-serif;
      font-size:18px;
      display:none;
    }
    #leaderboard h3 {
      margin:0 0 10px;
      font-size:20px;
      text-align:center;
    }
    #leaderboard ul {
      list-style:none;
      padding:0;
      margin:0;
    }
    #leaderboard li {
      padding:5px 0;
      border-bottom:1px solid #333;
    }
  </style>
</head>
<body>
  <div id="menu">
    <input id="playerName" type="text" placeholder="Adınızı girin" maxlength="12">
    <button class="menu-btn" onclick="startGame(800,600)">800 x 600 Başlat</button>
    <button class="menu-btn" onclick="startGame(1024,768)">1024 x 768 Başlat</button>
  </div>

  <!-- Modal öneri kutusu -->
  <div id="nameSuggestions">
    <div class="modal-content">
      <p>Bu isim kullanılıyor. İstersen şunları seçebilirsin:</p>
      <div id="suggestionButtons"></div>
      <button id="tryAgainBtn" class="suggestion-btn try-again-btn">Farklı isim dene</button>
    </div>
  </div>

  <div id="ui">
    Puan: <span id="score">0</span> | 
    En Yüksek: <span id="highscore">0</span> | 
    Seviye: <span id="level">1</span>
  </div>

  <div id="leaderboard">
    <h3>Skorlar</h3>
    <ul id="scoreList"></ul>
  </div>

  <div id="levelUp">LEVEL UP!</div>
  <button id="restart">Yeniden Başlat</button>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const scoreEl = document.getElementById("score");
    const highscoreEl = document.getElementById("highscore");
    const restartBtn = document.getElementById("restart");
    const levelEl = document.getElementById("level");
    const levelUpEl = document.getElementById("levelUp");
    const menu = document.getElementById("menu");
    const ui = document.getElementById("ui");
    const leaderboard = document.getElementById("leaderboard");
    const scoreList = document.getElementById("scoreList");
    const playerNameInput = document.getElementById("playerName");
    const nameSuggestions = document.getElementById("nameSuggestions");
    const suggestionButtons = document.getElementById("suggestionButtons");
    const tryAgainBtn = document.getElementById("tryAgainBtn");

    let score, highscore, gameOver, fallSpeed, spawnInterval, lastSpawn, redClickCount, normalCount;
    let level, nextLevelScore;
    let rocks, particles;
    let players, currentPlayerName;

    const images = {
      stone: new Image(),
      silver: new Image(),
      gold: new Image(),
      red: new Image()
    };
    images.stone.src = "stone.png";
    images.silver.src = "silver.png";
    images.gold.src = "gold.png";
    images.red.src = "red.png";

    class Rock {
      constructor(type) {
        this.type = type;
        this.size = Math.random() < 0.7 ? 60 : 90;
        this.speed = this.size === 60 ? fallSpeed * 1.0 : fallSpeed * 0.6;
        this.basePoints = this.size === 60 ? 1 : 0.5;
        this.x = Math.random() * (canvas.width - this.size);
        this.y = -this.size;
        this.rotation = 0;
        this.rotationSpeed = (Math.random() - 0.5) * 0.1;
      }
      update() {
        this.y += this.speed;
        this.rotation += this.rotationSpeed;
      }
      draw() {
        ctx.save();
        ctx.translate(this.x + this.size/2, this.y + this.size/2);
        ctx.rotate(this.rotation);
        ctx.drawImage(images[this.type], -this.size/2, -this.size/2, this.size, this.size);
        ctx.restore();
      }
    }

    class Particle {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.radius = Math.random() * 4 + 2;
        this.color = color;
        this.speedX = (Math.random() - 0.5) * 6;
        this.speedY = (Math.random() - 0.5) * 6;
        this.life = 40;
      }
      update() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.radius *= 0.95;
        this.life--;
      }
      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
      }
    }

    function initGame() {
      score = 0;
      highscore = localStorage.getItem("highscore") || 0;
      highscoreEl.textContent = highscore;
      gameOver = false;
      fallSpeed = 2;
      spawnInterval = 1500;
      lastSpawn = 0;
      redClickCount = 0;
      normalCount = 0;
      level = 1;
      nextLevelScore = 100;
      rocks = [];
      particles = [];
      scoreEl.textContent = score;
      levelEl.textContent = level;
      restartBtn.style.display = "none";

      players = [
        {name: currentPlayerName, score: 0},
        {name: "Oyuncu2", score: 0},
        {name: "Oyuncu3", score: 0}
      ];
      updateLeaderboard();
    }

    function spawnRock() {
      let type = "stone";
      normalCount++;
      if (normalCount > 15 && Math.random() < 0.2) type = "silver";
      if (normalCount > 30 && Math.random() < 0.1) type = "gold";
      if (score > 50 && Math.random() < 0.15) type = "red";
      rocks.push(new Rock(type));
    }

    function getColorForType(type) {
      if (type === "stone") return "gray";
      if (type === "silver") return "lightgray";
      if (type === "gold") return "gold";
      if (type === "red") return "red";
      return "white";
    }

    function gameLoop(timestamp) {
      if (gameOver) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (timestamp - lastSpawn > spawnInterval) {
        spawnRock();
        lastSpawn = timestamp;
      }
      fallSpeed += 0.0005;

      rocks.forEach((rock, i) => {
        rock.update();
        rock.draw();
        if (rock.y > canvas.height) rocks.splice(i, 1);
      });

      particles.forEach((p, i) => {
        p.update();
        p.draw();
        if (p.life <= 0 || p.radius < 0.5) particles.splice(i, 1);
      });

      players.forEach(p => {
        if (p.name !== currentPlayerName && Math.random() < 0.01) {
          p.score += Math.floor(Math.random() * 3);
        }
      });
      updateLeaderboard();

      requestAnimationFrame(gameLoop);
    }

    canvas.addEventListener("click", (e) => {
      if (gameOver) return;
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;

      rocks.forEach((rock, i) => {
        if (mx > rock.x && mx < rock.x + rock.size && my > rock.y && my < rock.y + rock.size) {
          for (let j = 0; j < 12; j++) {
            particles.push(new Particle(rock.x + rock.size/2, rock.y + rock.size/2, getColorForType(rock.type)));
          }

          if (rock.type === "stone") score += rock.basePoints;
          else if (rock.type === "silver") score += 10 * rock.basePoints;
          else if (rock.type === "gold") score += 100 * rock.basePoints;
          else if (rock.type === "red") {
            score = Math.floor(score * 0.5);
            redClickCount++;
            fallSpeed *= 0.5;
            rocks = [];
            if (redClickCount >= 3) endGame();
          }

          scoreEl.textContent = score;
          let me = players.find(p => p.name === currentPlayerName);
          if (me) me.score = score;

          updateLeaderboard();

          if (score >= nextLevelScore) {
            level++;
            levelEl.textContent = level;
            fallSpeed *= 1.2;
            if (spawnInterval > 600) spawnInterval -= 100;
            nextLevelScore += 100;
            showLevelUp();
          }

          rocks.splice(i, 1);
        }
      });
    });

    function showLevelUp() {
      levelUpEl.style.display = "block";
      levelUpEl.textContent = `LEVEL UP! (Seviye ${level})`;
      setTimeout(() => { levelUpEl.style.display = "none"; }, 2000);
    }

    function endGame() {
      gameOver = true;
      if (score > highscore) {
        highscore = score;
        localStorage.setItem("highscore", highscore);
        highscoreEl.textContent = highscore;
      }
      restartBtn.style.display = "block";
    }

    restartBtn.addEventListener("click", () => {
      initGame();
      requestAnimationFrame(gameLoop);
    });

    function generateSuggestions(baseName) {
      const suggestions = [];
      suggestions.push(baseName + Math.floor(Math.random() * 100));
      suggestions.push(baseName + "_1");
      suggestions.push(baseName + "_X");
      return suggestions;
    }

    function startGame(width, height) {
      let chosenName = playerNameInput.value.trim() || "Sen";
      const otherNames = ["Oyuncu2", "Oyuncu3"];

      if (otherNames.includes(chosenName)) {
        suggestionButtons.innerHTML = "";
        const suggested = generateSuggestions(chosenName);
        suggested.forEach(s => {
          const btn = document.createElement("button");
          btn.textContent = s;
          btn.className = "suggestion-btn";
          btn.onclick = () => {
            playerNameInput.value = s;
            nameSuggestions.style.display = "none";
          };
          suggestionButtons.appendChild(btn);
        });
        nameSuggestions.style.display = "flex";
        return; // oyun başlamasın
      }

      currentPlayerName = chosenName;
      canvas.width = width;
      canvas.height = height;
      canvas.style.display = "block";
      menu.style.display = "none";
      ui.style.display = "block";
      leaderboard.style.display = "block";
      initGame();
      requestAnimationFrame(gameLoop);
    }

    tryAgainBtn.addEventListener("click", () => {
      nameSuggestions.style.display = "none";
      playerNameInput.focus();
    });

    function updateLeaderboard() {
      scoreList.innerHTML = "";
      let sorted = [...players].sort((a, b) => b.score - a.score);
      
      sorted.forEach((p, index) => {
        const li = document.createElement("li");

        if (index === 0) {
          li.textContent = `🥇 ${p.name}: ${p.score}`;
          li.style.color = "gold";
          li.style.fontWeight = "bold";
        } else if (index === 1) {
          li.textContent = `🥈 ${p.name}: ${p.score}`;
          li.style.color = "silver";
          li.style.fontWeight = "bold";
        } else if (index === 2) {
          li.textContent = `🥉 ${p.name}: ${p.score}`;
          li.style.color = "#cd7f32";
          li.style.fontWeight = "bold";
        } else {
          li.textContent = `${p.name}: ${p.score}`;
          li.style.color = "white";
        }

        if (p.name === currentPlayerName) {
          li.style.color = "yellow";
          li.style.fontWeight = "bold";
          li.style.textShadow = "0 0 5px black";
        }

        scoreList.appendChild(li);
      });
    }
  </script>
</body>
</html>
