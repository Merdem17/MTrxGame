<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>MTrxGame</title>
  <style>
    body { text-align: center; font-family: Arial, sans-serif; margin: 0; background: #f0f0f0; }
    canvas { background: #222; display: block; margin: 20px auto; }
    #loginScreen { margin-top: 100px; }
    #walletAddress { padding:10px; width:300px; font-size:16px; }
    #gameScreen { display:none; }
  </style>
</head>
<body>
  <!-- Adres giriş ekranı -->
  <div id="loginScreen">
    <h2>Hoşgeldiniz</h2>
    <p>Lütfen FaucetPay adresinizi veya TronLink (TRX) adresinizi girin:</p>
    <input type="text" id="walletAddress" placeholder="TRX adresiniz (T...)" />
    <br><br>
    <button onclick="saveAddress()">Kaydet ve Başla</button>
  </div>

  <!-- Oyun ekranı -->
  <div id="gameScreen">
    <h2>MTrxGame</h2>
    <p>Kazım Gücü: <span id="power">0</span></p>
    <p>Mevcut Kazım: <span id="mined">0</span></p>
    <canvas id="gameCanvas" width="400" height="600"></canvas>
  </div>

  <script>
    let playerPower = parseFloat(localStorage.getItem("playerPower")) || 0;
    let playerMined = parseFloat(localStorage.getItem("playerMined")) || 0;
    const powerEl = document.getElementById("power");
    const minedEl = document.getElementById("mined");

    // Adres kaydet
    function saveAddress() {
      const addr = document.getElementById("walletAddress").value.trim();
      if (addr === "") {
        alert("Lütfen geçerli bir adres girin.");
        return;
      }
      localStorage.setItem("playerAddress", addr);
      startGame();
    }

    // Oyun başlat
    function startGame() {
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("gameScreen").style.display = "block";
      updateStats();
      gameLoop();
    }

    // Eğer önceden adres varsa direkt oyuna gir
    window.onload = function() {
      const savedAddr = localStorage.getItem("playerAddress");
      if (savedAddr) {
        startGame();
      }
    }

    function updateStats() {
      powerEl.textContent = playerPower.toFixed(10);
      minedEl.textContent = playerMined.toFixed(10);
      localStorage.setItem("playerPower", playerPower);
      localStorage.setItem("playerMined", playerMined);
    }

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const items = [
      {name: "stone", value: 0.0000000001, color: "gray", img: "stone.png"},
      {name: "silver", value: 0.0000000010, color: "silver", img: "silver.png"},
      {name: "gold", value: 0.0000000100, color: "gold", img: "gold.png"},
      {name: "red", value: -0.5, color: "red", img: "red.png"}
    ];

    let fallingItems = [];

    function spawnItem() {
      const rand = Math.random();
      let item;
      if (rand < 0.6) item = items[0];       // %60 taş
      else if (rand < 0.85) item = items[1]; // %25 silver
      else if (rand < 0.97) item = items[2]; // %12 gold
      else item = items[3];                  // %3 red

      fallingItems.push({
        ...item,
        x: Math.random() * (canvas.width - 30),
        y: -30,
        size: 30
      });
    }

    function gameLoop() {
      ctx.clearRect(0,0,canvas.width,canvas.height);

      if (Math.random() < 0.03) { // düşme sıklığı
        spawnItem();
      }

      fallingItems.forEach((item, i) => {
        const img = new Image();
        img.src = item.img;
        ctx.drawImage(img, item.x, item.y, item.size, item.size);
        item.y += 2;

        if (item.y + item.size > canvas.height) {
          if (item.name === "red") {
            playerMined *= 0.5; // %50 azalt
          } else {
            playerPower += item.value;
            playerMined += item.value;
          }
          fallingItems.splice(i, 1);
          updateStats();
        }
      });

      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>
